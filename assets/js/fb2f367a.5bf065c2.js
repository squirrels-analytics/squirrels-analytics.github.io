"use strict";(self.webpackChunksquirrels_docs=self.webpackChunksquirrels_docs||[]).push([[5480],{6653:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"docs/concepts/user","title":"User Model & Authentication","description":"The User model in Squirrels allows you to customize the attributes associated with each user in your application. By extending the BaseUser class, you can define additional custom fields that will be stored in the authentication database used by your Squirrels project.","source":"@site/docs/docs/concepts/user.md","sourceDirName":"docs/concepts","slug":"/docs/concepts/user","permalink":"/docs/docs/concepts/user","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Connections","permalink":"/docs/docs/concepts/connections"},"next":{"title":"Widget Parameters","permalink":"/docs/docs/concepts/parameters"}}');var r=s(4848),t=s(8453);const o={},l="User Model & Authentication",a={},d=[{value:"Configuration File",id:"configuration-file",level:2},{value:"Supported Field Types",id:"supported-field-types",level:2},{value:"Reserved and Disallowed Fields",id:"reserved-and-disallowed-fields",level:2},{value:"Dropping Columns",id:"dropping-columns",level:2},{value:"Adding Authentication Providers",id:"adding-authentication-providers",level:2},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"user-model--authentication",children:"User Model & Authentication"})}),"\n",(0,r.jsxs)(n.p,{children:["The User model in Squirrels allows you to customize the attributes associated with each user in your application. By extending the ",(0,r.jsx)(n.code,{children:"BaseUser"})," class, you can define additional custom fields that will be stored in the authentication database used by your Squirrels project."]}),"\n",(0,r.jsx)(n.h2,{id:"configuration-file",children:"Configuration File"}),"\n",(0,r.jsxs)(n.p,{children:["Custom user fields are configured in the ",(0,r.jsx)(n.code,{children:"pyconfigs/user.py"})," file. You can create a sample of this file by using the ",(0,r.jsx)(n.a,{href:"../../references/cli/get-file",children:"sqrl get-file"})," command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sqrl get-file user.py\n"})}),"\n",(0,r.jsx)(n.p,{children:"The contents of the example file looks like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from typing import Literal\nfrom squirrels import auth, arguments as args\n\n\nclass User(auth.BaseUser):\n    """\n    Extend the BaseUser class with custom attributes.\n    """\n    role: Literal["manager", "employee"] = "employee"\n\n    @classmethod\n    def dropped_columns(cls) -> list[str]:\n        return []\n\n\n# @auth.provider(name="google", label="Google", icon="https://www.google.com/favicon.ico")\ndef google_auth_provider(sqrl: args.AuthProviderArgs) -> auth.ProviderConfigs:\n    """\n    Provider configs for authenticating a user using Google credentials.\n\n    See the following page for setting up the CLIENT_ID and CLIENT_SECRET for Google specifically: \n    https://support.google.com/googleapi/answer/6158849?hl=en\n    """\n    def get_sqrl_user(claims: dict) -> User:\n        return User(\n            username=claims["email"],\n            is_admin=False,\n            role="employee"\n        )\n\n    # TODO: Add GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET to the .env file\n    # Then, uncomment the @auth.provider decorator above and set the client_id and client_secret below\n    provider_configs = auth.ProviderConfigs(\n        client_id="", # sqrl.env_vars["GOOGLE_CLIENT_ID"],\n        client_secret="", # sqrl.env_vars["GOOGLE_CLIENT_SECRET"],\n        server_metadata_url="https://accounts.google.com/.well-known/openid-configuration",\n        client_kwargs={"scope": "openid email profile"},\n        get_user=get_sqrl_user\n    )\n\n    return provider_configs\n'})}),"\n",(0,r.jsx)(n.h2,{id:"supported-field-types",children:"Supported Field Types"}),"\n",(0,r.jsx)(n.p,{children:"The User model supports the following field types:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"str"}),": Text fields"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"int"}),": Integer numbers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"float"}),": Decimal numbers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"bool"}),": Boolean values (True/False)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Literal"}),": Enumerated values with a fixed set of options"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To make a field nullable (allow NULL values), use the Union type syntax with ",(0,r.jsx)(n.code,{children:"None"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Nullable string field with None as default value\norganization: str | None = None\n\n# Nullable integer field with default value of 10\nemployee_id: int | None = 10\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"Literal"})," type from the ",(0,r.jsx)(n.code,{children:"typing"})," module to create fields with a fixed set of options:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'# Field that only accepts specific values\nrole: Literal["manager", "employee"] = "employee"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"All fields must have a default value."})," When adding a new field to the User model, the field for all existing users in the database will be set to the default value."]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["If the ",(0,r.jsx)(n.code,{children:"SQRL_SECRET__ADMIN_PASSWORD"})," ",(0,r.jsx)(n.a,{href:"./environment",children:"environment variable"}),' is set, the "admin" user (i.e., username = "admin") will be created for you automatically using the default values from the User model.']}),(0,r.jsxs)(n.p,{children:['If the fields of the "admin" user should be different than the default values, you can change it in ',(0,r.jsx)(n.a,{href:"../concepts/studio",children:"Squirrels Studio"}),' ("Menu" -> "Manage Users") when authenticated as an admin user, or by using the ',(0,r.jsx)(n.a,{href:"../../references/rest/user-management#update-user-",children:"Update User"})," REST API."]})]}),"\n",(0,r.jsx)(n.h2,{id:"reserved-and-disallowed-fields",children:"Reserved and Disallowed Fields"}),"\n",(0,r.jsx)(n.p,{children:"The following fields are reserved and managed by the system:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"username"}),": Primary identifier for the user (string)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"is_admin"}),": Boolean flag indicating administrator privileges"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following fields are disallowed and cannot be used in your User model:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"password"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"password_hash"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"created_at"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"token_id"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"exp"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dropping-columns",children:"Dropping Columns"}),"\n",(0,r.jsxs)(n.p,{children:["If you need to remove previously defined columns, use the ",(0,r.jsx)(n.code,{children:"dropped_columns"})," class method:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from squirrels import auth\n\nclass User(auth.BaseUser):\n    # ... other fields ...\n    old_field: str | None = None  # Although this line can be safely removed, it is included as a record of what was removed\n\n    @classmethod\n    def dropped_columns(cls) -> list[str]:\n    """\n    List columns that should be dropped from the database.\n    """\n    return ["old_field"]\n'})}),"\n",(0,r.jsx)(n.h2,{id:"adding-authentication-providers",children:"Adding Authentication Providers"}),"\n",(0,r.jsxs)(n.p,{children:["Squirrels supports adding third-party authentication providers (such as Google, Facebook, etc.) that implement the ",(0,r.jsx)(n.a,{href:"https://openid.net/connect/",children:"OpenID Connect"})," protocol to your application."]}),"\n",(0,r.jsxs)(n.p,{children:["To add an authentication provider, you must first register a client with the OpenID provider, and obtain the client ID and secret, as well as the server metadata URL and scope from the provider. For example, to register a client with Google, you can follow the instructions ",(0,r.jsx)(n.a,{href:"https://support.google.com/googleapi/answer/6158849?hl=en",children:"here"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Save the client ID and secret as ",(0,r.jsx)(n.a,{href:"./environment",children:"environment variables"})," in the ",(0,r.jsx)(n.code,{children:".env"})," file."]}),"\n",(0,r.jsxs)(n.p,{children:["Then, for each authentication provider, you must create a function that returns a ",(0,r.jsx)(n.a,{href:"../../references/python/auth/ProviderConfigs",children:"ProviderConfigs"})," object. This object contains the client ID, client secret, server metadata URL, and scope for the provider. It also contains a function that maps the claims from the OpenID provider to a Squirrels user object. Each function must be decorated with the ",(0,r.jsx)(n.code,{children:"@auth.provider"})," decorator to provide the name, label, and icon for the provider."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, to add a Google authentication provider, you can create the ",(0,r.jsx)(n.a,{href:"./environment",children:"environment variables"})," ",(0,r.jsx)(n.code,{children:"GOOGLE_CLIENT_ID"})," and ",(0,r.jsx)(n.code,{children:"GOOGLE_CLIENT_SECRET"}),", and create a function like this:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'@auth.provider(name="google", label="Google", icon="https://www.google.com/favicon.ico")\ndef google_auth_provider(sqrl: args.AuthProviderArgs) -> auth.ProviderConfigs:\n    """\n    Provider configs for authenticating a user using Google credentials.\n\n    See the following page for setting up the CLIENT_ID and CLIENT_SECRET for Google specifically: \n    https://support.google.com/googleapi/answer/6158849?hl=en\n    """\n    def get_sqrl_user(claims: dict) -> User:\n        return User(\n            username=claims["email"],\n            is_admin=False,\n            role="employee"\n        )\n\n    provider_configs = auth.ProviderConfigs(\n        client_id=sqrl.env_vars["GOOGLE_CLIENT_ID"],\n        client_secret=sqrl.env_vars["GOOGLE_CLIENT_SECRET"],\n        server_metadata_url="https://accounts.google.com/.well-known/openid-configuration",\n        client_kwargs={"scope": "openid email profile"},\n        get_user=get_sqrl_user\n    )\n\n    return provider_configs\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Always provide meaningful default values for required fields"}),"\n",(0,r.jsxs)(n.li,{children:["Use nullable fields (",(0,r.jsx)(n.code,{children:"Type | None"}),") when a field might not apply to all users"]}),"\n",(0,r.jsxs)(n.li,{children:["Consider using ",(0,r.jsx)(n.code,{children:"Literal"})," types to enforce valid options"]}),"\n",(0,r.jsx)(n.li,{children:"Document your User model fields with comments"}),"\n",(0,r.jsxs)(n.li,{children:["When removing fields, add them to ",(0,r.jsx)(n.code,{children:"dropped_columns()"})," rather than deleting them from the model"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);
"use strict";(self.webpackChunksquirrels_docs=self.webpackChunksquirrels_docs||[]).push([[7834],{9766:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"docs/concepts/models-federate","title":"Federate Models","description":"Federate models in Squirrels are the final layer in your data transformation pipeline. They combine data from multiple sources and models, apply final transformations, and expose data to end users. They support both SQL and Python transformations and are designed for user-facing data models that respond to user attributes and parameter selections.","source":"@site/docs/docs/concepts/models-federate.md","sourceDirName":"docs/concepts","slug":"/docs/concepts/models-federate","permalink":"/docs/docs/concepts/models-federate","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Dbview Models","permalink":"/docs/docs/concepts/models-dbview"},"next":{"title":"Dashboards","permalink":"/docs/docs/concepts/dashboards"}}');var i=s(4848),t=s(8453);const o={},a="Federate Models",d={},l=[{value:"Configuration",id:"configuration",level:2},{value:"Key Properties",id:"key-properties",level:2},{value:"How Federate Models Work",id:"how-federate-models-work",level:2},{value:"Conditional Columns",id:"conditional-columns",level:2},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"federate-models",children:"Federate Models"})}),"\n",(0,i.jsx)(n.p,{children:"Federate models in Squirrels are the final layer in your data transformation pipeline. They combine data from multiple sources and models, apply final transformations, and expose data to end users. They support both SQL and Python transformations and are designed for user-facing data models that respond to user attributes and parameter selections."}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Federate models consist of two files:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"A SQL or Python file with the transformation logic"}),"\n",(0,i.jsx)(n.li,{children:"A YAML file with metadata"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example SQL file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"    SELECT *\n    FROM {{ ref(\"build_example\") }}\n    WHERE date >= '{{ ctx.min_date }}'\n        AND date <= '{{ ctx.max_date }}'\n        AND amount >= {{ ctx.min_amount }}\n        AND amount <= {{ ctx.max_amount }}\n    {%- if ctx.has_categories %}\n        AND category_id IN ({{ ctx.category_ids_quoted_joined }})\n    {%- endif %}\n    {%- if ctx.has_subcategories %}\n        AND subcategory_id IN ({{ ctx.subcategory_ids_quoted_joined }})\n    {%- endif %}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example Python file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'def model(sqrl):\n    # Get dependency\n    build_df = sqrl.ref("build_example")\n    \n    # Apply filters\n    result = build_df.filter(\n        (pl.col("date") >= sqrl.ctx["min_date"]) &\n        (pl.col("date") <= sqrl.ctx["max_date"]) &\n        (pl.col("amount") >= sqrl.ctx["min_amount"]) &\n        (pl.col("amount") <= sqrl.ctx["max_amount"])\n    )\n    \n    if "categories" in sqrl.ctx:\n        result = result.filter(pl.col("category_id").is_in(sqrl.ctx["category_ids"]))\n    \n    if "subcategories" in sqrl.ctx:\n        result = result.filter(pl.col("subcategory_id").is_in(sqrl.ctx["subcategory_ids"]))\n    \n    return result\n'})}),"\n",(0,i.jsx)(n.p,{children:"Example YAML file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"description: |\n  This is an example of a federate view model. It takes the build example model and groups or filters the results based on the parameter selections provided.\n\n  Parameters are available to specify the group by dimension and filter by date, amount of the transaction, category, and subcategory.\n\ndepends_on:                # List of models this federate depends on\n  - build_example\n\neager: false               # Whether to materialize as a table (true) or view (false) in memory before proceeding to downstream models\n\ncolumns:\n  - name: date\n    type: string\n    condition: parameter 'group_by' (Group By) is 'g0' (Transaction)\n    description: The date of the transaction in 'YYYY-MM-DD' format, in descending order\n    category: dimension\n    depends_on:\n      - build_example.date\n  \n  - name: day\n    type: string\n    condition: parameter 'group_by' (Group By) is 'g1' (Day)\n    description: The day for which the amount is aggregated by, in descending order\n    category: dimension\n    depends_on:\n      - build_example.date\n  \n  - name: month\n    type: string\n    condition: parameter 'group_by' (Group By) is 'g4' (Month)\n    description: The month for which the amount is aggregated by, in descending order\n    category: dimension\n    depends_on:\n      - build_example.month\n\n  - name: category\n    type: string\n    condition: parameter `group_by` (Group By) is `g0` (Transaction), `g2` (Category), or `g3` (Subcategory)\n    description: The category for which the amount is aggregated by\n    category: dimension\n    depends_on:\n      - build_example.category\n  \n  - name: total_amount\n    type: float\n    description: The total amount spent by the group by dimension\n    category: measure\n    depends_on:\n      - build_example.amount\n"})}),"\n",(0,i.jsx)(n.h2,{id:"key-properties",children:"Key Properties"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"description"}),": A human-readable description of the federate model"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"depends_on"}),": List of models this model depends on"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"eager"}),": Whether to materialize as a table (true) or view (false, default) in memory before proceeding to downstream models"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"columns"}),": Definitions of columns produced by the model","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"name"}),": Column name"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"type"}),": Data type for the column. See the ",(0,i.jsx)(n.a,{href:"./column-types",children:"Column Types"})," documentation for supported types"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"description"}),": Human-readable description of the column"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"category"}),": Category of the column (dimension, measure, misc)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"depends_on"}),": List of upstream columns this column depends on"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"condition"}),": Condition that determines when this column is present in the result"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"how-federate-models-work",children:"How Federate Models Work"}),"\n",(0,i.jsx)(n.p,{children:"Federate models are the final layer in your data pipeline, providing a flexible interface for user interaction:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Parameters and Context"}),": Federate models can access:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Context variables via ",(0,i.jsx)(n.code,{children:"ctx"})," (set by context.py, often derived from parameters or user fields)"]}),"\n",(0,i.jsxs)(n.li,{children:["Parameter values via ",(0,i.jsx)(n.code,{children:"prms"})," (selected from parameter dropdowns)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Dynamic SQL/Python"}),": Federate models typically contain:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Conditional logic that changes based on parameter selections"}),"\n",(0,i.jsx)(n.li,{children:"Dynamic filters applied based on user inputs"}),"\n",(0,i.jsx)(n.li,{children:"Different aggregation levels determined by parameters"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Materialization Options"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eager: false"})," (default): Materializes as a view in memory, optimized based on downstream queries and executed on-demand"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"eager: true"}),": Materializes as a table in memory before proceeding to downstream models"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Column Metadata with Conditions"}),": Column definitions can include conditions that:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Document when columns appear in results based on parameter selections"}),"\n",(0,i.jsx)(n.li,{children:"Help generate accurate metadata for visualizations and APIs"}),"\n",(0,i.jsx)(n.li,{children:"Enable automatic parameter-dependent schema changes"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Federate models can depend on ",(0,i.jsx)(n.a,{href:"./models-source",children:"sources"})," (with ",(0,i.jsx)(n.code,{children:"load_to_duckdb: true"}),"), ",(0,i.jsx)(n.a,{href:"./models-seed",children:"seeds"}),", ",(0,i.jsx)(n.a,{href:"./models-build",children:"build models"}),", ",(0,i.jsx)(n.a,{href:"./models-dbview",children:"dbview models"}),", and other federate models. This is all data models except sources with ",(0,i.jsx)(n.code,{children:"load_to_duckdb: false"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"conditional-columns",children:"Conditional Columns"}),"\n",(0,i.jsxs)(n.p,{children:["Federate models may have conditional columns that appear or disappear based on parameter selections. The ",(0,i.jsx)(n.code,{children:"condition"})," property in column definitions serves two purposes:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Documentation"}),": Clearly explains when each column appears"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Metadata"}),": Helps tools understand the dynamic schema"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: day\n  type: string\n  condition: parameter 'group_by' (Group By) is 'g1' (Day)\n  description: The day for which the amount is aggregated by\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Apply defensive programming"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Check for parameter existence before using values"}),"\n",(0,i.jsx)(n.li,{children:"Handle edge cases and missing values gracefully"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Balance flexibility and performance"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"eager: true"})," for calculations that are reused by many downstream models"]}),"\n",(0,i.jsxs)(n.li,{children:["Use ",(0,i.jsx)(n.code,{children:"eager: false"})," for saving memory and improving performance when the model is not reused"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Document conditional behavior"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Use the ",(0,i.jsx)(n.code,{children:"condition"})," property to document when columns appear"]}),"\n",(0,i.jsx)(n.li,{children:"Keep column conditions consistent with the actual code logic"}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);